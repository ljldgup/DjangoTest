<!DOCTYPE html>
<html>
<head>
    <title>交易汇总</title>
</head>
	<body style="background:rgb(250, 250, 255)">
	
		<div style="width:1000px">
			<h1>个人交易汇总</h1>
		</div>
		
		<div style="width:1100px">
			<form action="/trade_report/" method="get" style="float:left; width:760px;">
				股票 <input type="text" name="r_name" value="{{r_name| default_if_none:""}}"> <br>
				开始时间<input type="date" name="st_date" value="{{st_date | default_if_none:"2017-01-01"}}"> <br>
				结束时间<input type="date" name="ed_date" value="{{ed_date | default_if_none:""}}">
				<input type="submit" value="提交">
			</form>
			<div style="float:right; width:300px; text-align:center">
				<h2>交易统计结果</h2>
			</div>
		</div>
		<div style="width:1100px">
			<table border="1" style="float:left; width:760px;" id="stat_data">
				<tbody>
					<tr>
						<th>股票</th>
						<th>最初买入日期</th>
						<th>最终卖出日期</th>
						<th>总买入金额</th>
						<th>总卖出金额</th>
						<th>总持股时间</th>
						<th>盈亏金额</th>
						<th>盈亏百分比</th>
					</tr>
				{% for i in stat_data %}
					<tr>
						<td><a href="/trade_detail/{{i.code}}/" target="_blank">{{i.name}}</a></td>
						<td>{{i.i_date|date:'Y-m-d'}}</td>
						<td>{{i.o_date|date:'Y-m-d'}}</td>
						<td>{{i.i_total}}</td>
						<td>{{i.o_total}}</td>
						<td>{{i.time}}</td>
						
						{% if i.earning >= 0 %}
						<td style="color:red">{{i.earning}}</td>
						<td style="color:red">{{i.pct}}</td>
						{% else %}
						<td style="color:green">{{i.earning}}</td>
						<td style="color:green">{{i.pct}}</td>
						{% endif %}
						
					</tr>
				{% endfor %}
				</tbody>
			</table>
			<div style="float:left; width:300px; margin-left:8px" id="stat_res">
				<script type="text/javascript">
				/** 
				 * 遍历表格内容进行统计
				 */
					var mytable = document.getElementById("stat_data");
					var data = {t_win_earning:0, t_los_earning:0, t_win_num:0, t_los_num:0, t_win_10_num:0, t_los_5_num:0, t_win_10_earning:0, t_los_5_earning:0};
					var tmp = 0;
					var pct = 0;
					
					for(var i=1, rows=mytable.rows.length; i<rows; i++){
					  tmp = parseFloat(mytable.rows[i].cells[6].innerHTML);
					  pct = parseFloat(mytable.rows[i].cells[7].innerHTML);
					  if(tmp > 0){
						data.t_win_earning += tmp;
						data.t_win_num += 1;
						if(pct > 10){
							data.t_win_10_earning += tmp;
							data.t_win_10_num += 1;
						}
					  }
					  else{
						data.t_los_earning += tmp;
						data.t_los_num += 1;
						if(pct < -5){
							data.t_los_5_earning += tmp;
							data.t_los_5_num += 1;
						}
					  }
					}
					
					t_rate = parseInt(data.t_win_num/(data.t_los_num + data.t_win_num)*1000)/10.0
					document.write("<p>&nbsp&nbsp&nbsp&nbsp总收益：" + data.t_win_earning + "</p>");
					document.write("<p>&nbsp&nbsp&nbsp&nbsp总亏损：" + data.t_los_earning + "</p>");
					document.write("<p>&nbsp&nbsp&nbsp&nbsp合计：" +  (data.t_win_earning + data.t_los_earning) + "</p>");
					document.write("<p>&nbsp&nbsp&nbsp&nbsp成功次数：" + data.t_win_num + "</p>");
					document.write("<p>&nbsp&nbsp&nbsp&nbsp失败次数：" + data.t_los_num + "</p>");
					document.write("<p>&nbsp&nbsp&nbsp&nbsp成功率：" + t_rate + "&#37</p>");
					document.write("<p>&nbsp&nbsp&nbsp&nbsp盈利大于10%的次数：" + data.t_win_10_num + "</p>");
					document.write("<p>&nbsp&nbsp&nbsp&nbsp盈利大于10%的总收益：" + data.t_win_10_earning + "</p>");
					document.write("<p>&nbsp&nbsp&nbsp&nbsp亏损大于5%的次数：" + data.t_los_5_num + "</p>");
					document.write("<p>&nbsp&nbsp&nbsp&nbsp亏损大于5%的总收益：" + data.t_los_5_earning + "</p>");
				</script>
			</div>

		</div>
	</body>
	
</html>
