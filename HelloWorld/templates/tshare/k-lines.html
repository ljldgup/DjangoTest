		    <!-- 为ECharts准备一个具备大小（宽高）的DOM -->
    <div id="main" style="width: 1200px; height: 600px; float-div{ float:right};"></div>
	<script type="text/javascript">

        /*基于准备好的dom，初始化echarts实例*/
        var myChart = echarts.init(document.getElementById('main'));

        // 数据意义：开盘(open)，收盘(close)，最低(lowest)，最高(highest)
        var data0 = splitData([
			{% for i in k_data %}
			['{{i.date}}',{{i.open}},{{i.close}},{{i.low}},{{i.high}}]{% if not forloop.last %},{% endif %}
			{% endfor %}
        ]);

        //切割数组，把数组中的日期和数据分离，返回数组中的日期和数据
        function splitData(rawData) {
            var categoryData = [];
            var values = [];
            
            for (var i = 0; i < rawData.length; i++) {
                //splice 返回每组数组中被删除的第一项，即返回数组中被删除的日期 
                //alert(rawData[i].splice(0, 1)[0]);
                //categoryData  日期  把返回的日期放到categoryData[]数组中
                categoryData.push(rawData[i].splice(0, 1)[0]);
                //alert(categoryData);

                //数据数组，即数组中除日期外的数据
               // alert(rawData[i]);
                values.push(rawData[i])
            }
            return {
                categoryData: categoryData, //数组中的日期 x轴对应的日期
                values: values              //数组中的数据 y轴对应的数据
            };
        }

    //计算MA平均线，N日移动平均线=N日收盘价之和/N  dayCount要计算的天数(5,10,20,30)
        function calculateMA(dayCount) {
            var result = [];
            for (var i = 0, len = data0.values.length; i < len; i++) {
                if (i < dayCount) {
                    result.push('-');
                    //alert(result);
                    continue;   //结束单次循环，即不输出本次结果
                }
                var sum = 0;
                for (var j = 0; j < dayCount; j++) {
                    //收盘价总和
                    sum += data0.values[i - j][1];
                    //alert(sum);
                }
                result.push(sum / dayCount);
               // alert(result);
            }
            return result;
        }



        option = {
            title: {    //标题
                text: '{{r_name}}',
                left: 0
            },
            tooltip: {  //提示框
                trigger: 'axis',    //触发类型：坐标轴触发
                axisPointer: {  //坐标轴指示器配置项
                    type: 'cross'   //指示器类型，十字准星
                }
            },
            legend: {   //图例控件，点击图例控制哪些系列不现实
                data: ['日K', 'MA5', 'MA20', 'MA200']
            },
            grid: {     //直角坐标系
                show:true,
                left: '10%',    //grid组件离容器左侧的距离
                right: '10%',
                bottom: '15%',
                //backgroundColor:'#ccc'
            },
            xAxis: {
                type: 'category',   //坐标轴类型，类目轴
                data: data0.categoryData,
                //scale: true,  //只在数字轴中有效
                boundaryGap : false,    //刻度作为分割线，标签和数据点会在两个刻度上
                axisLine: {onZero: false},
                splitLine: {show: false},   //是否显示坐标轴轴线
                //splitNumber: 20,    //坐标轴的分割段数，预估值，在类目轴中无效
                min: 'dataMin', //特殊值，数轴上的最小值作为最小刻度
                max: 'dataMax'  //特殊值，数轴上的最大值作为最大刻度
            },
            yAxis: {
                scale: true,    //坐标刻度不强制包含零刻度
                splitArea: {
                    show: true  //显示分割区域
                }
            },
            dataZoom: [     //用于区域缩放
                {
                    filterMode:'filter',    //当前数据窗口外的数据被过滤掉来达到数据窗口缩放的效果  默认值filter
                    type: 'inside', //内置型数据区域缩放组件
                    start: 50,      //数据窗口范围的起始百分比
                    end: 100        //数据窗口范围的结束百分比
                },
                {
                    show: true,
                    type: 'slider', //滑动条型数据区域缩放组件
                    y: '90%',
                    start: 50,
                    end: 100
                }
            ],
            series: [   //图表类型
                {
                    name: '日K',
                    type: 'candlestick',    //K线图
                    data: data0.values,     //y轴对应的数据

////////////////////////图标标注/////////////////////////////
				markPoint: {
					label: {
						normal: {
							formatter: function (param) {
								return param.value;
							}
						}
					},
					data: [
						{% for i in ori_data %}
						{
							name: '{{i.operation}} {{i.id}}',
							coord: ['{{i.date|date:'Y-m-d'}}',{{i.price}}],
							value: {{i.price}},
							itemStyle: {
								{% if '买入' in i.operation%}
								normal: {color: 'rgb(128,0,0)'}
								{% else %}
								normal: {color: 'rgb(0,128,0)'}
								{% endif %}
							}
						}{% if not forloop.last %},{% endif %}
						{% endfor %}
					],
					tooltip: {
						formatter: function (param) {
							return param.name + '<br>' + (param.data.coord || '');
						}
					}
				}


/////////////////////////////////图标标线///////////////////////////

                },

                {   //MA5 5天内的收盘价之和/5
                    name: 'MA5',
                    type: 'line',
                    data: calculateMA(5),
                    smooth: true,
                    lineStyle: {
                        normal: {opacity: 0.5}
                    }
                },
                {
                    name: 'MA20',
                    type: 'line',
                    data: calculateMA(20),
                    smooth: true,
                    lineStyle: {    //标线的样式
                        normal: {opacity: 0.5}
                    }
                },
                {
                    name: 'MA200',
                    type: 'line',
                    data: calculateMA(250),
                    smooth: true,
                    lineStyle: {
                        normal: {opacity: 0.5}
                    }
                }
            ]
        };


        // 使用刚指定的配置项和数据显示图表
        myChart.setOption(option);
    </script>